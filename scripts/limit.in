#!/usr/bin/env bash
bin="$(cd -- "$(dirname "$(readlink -f "${BASH_SOURCE[0]}")")" && pwd -P)"
runlim="$bin"/runlim
for i in runlim; do
    [ ! -x "${!i}" ] && echo "$(basename "$0"): missing executable $i (${!i})" >&2 && exit 1
done
[ $# -lt 1 ] && echo "usage: $(basename "$0") <executable>" && exit 0

log=/dev/null
name=$1
shift

[[ -n "${LIMIT_LOG:-}" ]] && log="${LIMIT_LOG}-$name.run"

echo "$(basename "$0") $name to ${TIME:-unlimited} seconds and ${SPACE:-unlimited} MB"

$runlim --propagate --single \
    -o "$log" \
    ${TIME:+--real-time-limit="$TIME"} \
    ${SPACE:+--space-limit="$SPACE"} \
    $@
